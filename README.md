# lexoffice Analytics

Applications and libraries, used for interacting with the [lexoffice Public API](https://developers.lexoffice.io/docs/#lexoffice-api-documentation).

![](docs/sys-arch.svg)

This *Rust Workspace* contains the following components:

- [openapi](/openapi): Provides types and functions for fetching data from lexoffice Public API. Automatically generated by [OpenAPI Generator](https://openapi-generator.tech/) using the API description in [lexoffice-api.yml](lexoffice-api.yml)
- [sync](/sync): Provides functions for saving data from lexoffice to a PostgreSQL database and retrieving the locally stored data
Supported data types from lexoffice API:
  - Vouchers from `voucherlist` endpoint
  - Invoices from `invoices` endpoint
- [lexoffice-cli](/lexoffice-cli): User application (CLI) which supports interacting with the `sync` component

## lexoffice-cli

The `lexoffice-cli` can be run inside a Docker container. To do that, simply use the [Dockerfile](lexoffice-cli/Dockerfile) or run with `docker compose up`.

When running the application, the following environment variables are expected to be set:

- `DATABASE_URL`: PostgreSQL connection string (e. g. `postgres://[user]:[password]@[host]:[port]/[database]`)
- `LEXOFFICE_APIKEY`: API Key for Lexoffice account (create one [here](https://app.lexoffice.de/addons/public-api))
- `API_RATE_LIMIT` (optional, default 2): Limit of maximum requests per second (more info [here](https://developers.lexoffice.io/docs/#api-rate-limits))

**Usage:**

```shell
$ lexoffice-cli sync <VOUCHER_TYPE>
```

The parameter `VOUCHER_TYPE` is optional and can be one of the following:

- salesinvoice
- salescreditnote
- purchaseinvoice
- purchasecreditnote
- invoice
- downpaymentinvoice
- creditnote
- orderconfirmation
- quotation
- deliverynote

If `VOUCHER_TYPE` is not provided, all voucher types will be updated.

## openapi

Install the required dependencies using Node.js (only once).
Then the OpenAPI client can be generated using the `generate` script:

```shell
$ npm install
$ npm run generate
```