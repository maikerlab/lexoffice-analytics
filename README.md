# lexoffice Analytics

Save and visualize data from the [lexoffice Public API](https://developers.lexoffice.io/docs/#lexoffice-api-documentation).

![](docs/sys-arch.svg)

This project contains a Rust workspace with the following components:

- [lexoffice-cli](/lexoffice-cli): User application which supports commands to fetch and save data from lexoffice. Data will be saved to a MongoDB Cluster, self-hosting with PostgreSQL may be supported in the future.
- [lexoffice-models](/lexoffice-models): Contains types for stored data and functions for converting to/from lexoffice types
- [openapi](/openapi): Library containing types from lexoffice API and functions for executing API calls. Generated by [OpenAPI Generator](https://openapi-generator.tech/) using the OpenAPI specification in [lexoffice-api.yml](lexoffice-api.yml)
- *Web App*: May be implemented in the future to support visualizing or interacting with the stored data


## lexoffice-cli

The `lexoffice-cli` can be run inside a Docker container. To do that, simply use the [Dockerfile](lexoffice-cli/Dockerfile) or run with `docker compose up`.

When running the application, the following environment variables are expected to be set:

- `DATABASE_URL`: MongoDB connection string (`mongodb://[user]:[password]@[host]:[port]/[connection options]`)
- `LEXOFFICE_APIKEY`: API Key for Lexoffice account (create one [here](https://app.lexoffice.de/addons/public-api))

**Usage:**

```shell
$ lexoffice-cli sync <VOUCHER_TYPE> --from <FROM_DATE> --to <TO_DATE>
```

The argument `VOUCHER_TYPE` is optional and currently supports:

- `all`
- `invoice`

If `VOUCHER_TYPE` is not provided, all voucher types will be updated.

A specific date range can be provided with the optional arguments `--from` and `--to` in the format `YYYY-MM-DD`.
If only one is provided, the maximum start/end date will be used for the other argument.

## openapi

Re-generating the openapi Library Crate is only necessary after modifiying the OpenAPI spec ([lexoffice-api.yml](lexoffice-api.yml)).

To do this, first install the required dependencies for Node.js (only once).
Then the OpenAPI client can be generated using the `generate` script:

```shell
$ npm install
$ npm run generate
```

